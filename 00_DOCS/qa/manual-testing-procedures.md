# Manual Testing Procedures

## Metadata

- **Version:** 0.4.0
- **Last Updated:** 2025-11-21
- **Generated By:** /ccm-prepare-test-scenarios
- **Focus Areas:** Installation lifecycle, uninstall hooks, backup dual detection, sync engine, update-check command, artifact installation, error handling
- **Total Scenarios:** 11 (1 sequential + 10 parallel)
- **Required Scenarios (v0.4.0):** 8 scenarios (73% of total)
- **Changed Components:** CLI commands (2), library modules (2), scripts (3), entry point (1), artifacts (extensive)

---

## Overview

This document defines manual testing procedures for the CCM package release. Tests are organized into stages:

- **Stage 1:** Sequential conflict-prone tests (1 agent, real system)
- **Stage 2:** Parallel isolated tests (up to 10 agents, isolated worktrees)

Each scenario includes:
- **Happy Path:** Step-by-step test instructions
- **Expected Outcomes:** What should happen if test passes
- **Bug Reporting:** When to create bug reports

---

## Stage 1: Sequential Conflict-Prone Tests

**Purpose:** Validate global installation workflows that modify shared system state

**Agent Count:** 1
**Environment:** Real system (~/.claude-context-manager/, ~/.claude/)
**Execution:** Sequential (no parallel agents)

### Scenario 1.1: install-uninstall-update **[CHANGED IN v0.4.0]**

**Purpose:** Validate complete installation lifecycle

**Changes in v0.4.0:**
- New preuninstall.js hook added
- Modified uninstall.js logic
- Updated sync-engine.js
- Updated postinstall.js
- Entry point changes (bin/claude-context-manager.js)

**Prerequisites:**
- Package published to NPM registry
- User has npm installed (v8+)
- User has write access to global npm directory

**Happy Path:**

1. **Verify current state:**
   ```bash
   ccm --version 2>&1 || echo "Not installed"
   ls ~/.claude-context-manager/ 2>&1 || echo "Directory does not exist"
   ```

2. **Install package globally:**
   ```bash
   npm install -g @vladimir-ks/claude-context-manager@0.4.0
   ```

3. **Verify installation:**
   ```bash
   ccm --version  # Should output: 0.4.0
   which ccm      # Should show global bin path
   ```

4. **Verify home directory created:**
   ```bash
   ls -la ~/.claude-context-manager/
   cat ~/.claude-context-manager/registry.json  # Should be valid JSON
   cat ~/.claude-context-manager/config.json    # Should be valid JSON
   ```

5. **Verify CCM files synced:**
   ```bash
   ls ~/.claude/ccm*.md  # Should list all CCM files
   cat ~/.claude-context-manager/registry.json | jq '.ccm_files'  # Should list synced files
   ```

6. **Verify CLAUDE.md header generated:**
   ```bash
   head -30 ~/.claude/CLAUDE.md  # Should contain CCM header with file references
   grep "@./ccm01-USER-SETTINGS.md" ~/.claude/CLAUDE.md  # Should exist
   ```

7. **Install package artifact:**
   ```bash
   ccm install --package core-essentials --global
   ```

8. **Verify artifact installed:**
   ```bash
   ccm status --global | grep "managing-claude-context"  # Should show installed
   ls ~/.claude/skills/managing-claude-context/  # Directory should exist
   ```

9. **Test update notification:**
   ```bash
   ccm notifications check  # Should check for updates
   ```

10. **Uninstall package artifact:**
    ```bash
    ccm uninstall --package core-essentials --global
    ```

11. **Verify artifact removed:**
    ```bash
    ccm status --global | grep "managing-claude-context" || echo "Removed"  # Should not be installed
    ```

12. **Test full package update:**
    ```bash
    npm update -g @vladimir-ks/claude-context-manager  # Should complete without errors
    ```

**Expected Outcomes:**

- ✅ All commands return exit code 0
- ✅ Home directory created with correct structure
- ✅ Registry and config files are valid JSON
- ✅ CCM files synced with correct checksums
- ✅ CLAUDE.md header contains all CCM file references wrapped in HTML comments
- ✅ User content in CLAUDE.md preserved below header
- ✅ Artifact installed successfully and appears in status
- ✅ Artifact removed successfully and does not appear in status
- ✅ Update notification system functional
- ✅ Package update completes without errors

**Bug Reporting Triggers:**

- **Critical:** Home directory not created, registry corruption, CLAUDE.md user content lost
- **High:** Installation fails, artifacts not installed, checksum mismatch
- **Medium:** Update notification fails, status display incorrect
- **Low:** Minor UI issues, formatting problems

---

## Stage 2: Parallel Isolated Tests

**Purpose:** Validate package functionality in isolated environments (no collision risk)

**Agent Count:** Up to 10 agents
**Environment:** Isolated worktrees with fake HOME directories
**Execution:** Parallel (all agents run simultaneously)

### Scenario 2.1: list-and-search

**Agent:** worktree-agent-1
**Purpose:** Validate catalog browsing and search functionality

**Prerequisites:**
- Package installed in isolated HOME
- Catalog files present in package

**Happy Path:**

1. **Set isolated HOME:**
   ```bash
   export HOME=$(pwd)/.home
   ```

2. **Install package:**
   ```bash
   npm install -g @vladimir-ks/claude-context-manager@0.4.0
   ```

3. **Test list command:**
   ```bash
   ccm list  # Should display all artifacts
   ```

4. **Test filtered list:**
   ```bash
   ccm list --skills  # Should show only skills
   ccm list --commands  # Should show only commands
   ccm list --free  # Should show only free-tier artifacts
   ```

5. **Test search command:**
   ```bash
   ccm search context  # Should return relevant results
   ccm search managing  # Should find managing-claude-context skill
   ```

**Expected Outcomes:**

- ✅ List displays all packages, skills, commands
- ✅ Filters work correctly
- ✅ Search returns relevant results
- ✅ Tier indicators shown correctly (FREE/PREMIUM)
- ✅ Formatting is clear and readable

**Bug Reporting Triggers:**

- **High:** List shows no artifacts, catalog loading fails
- **Medium:** Filter doesn't work, search returns irrelevant results
- **Low:** Formatting issues, missing metadata

---

### Scenario 2.2: status-reporting

**Agent:** worktree-agent-2
**Purpose:** Validate installation status reporting

**Prerequisites:**
- Package installed in isolated HOME

**Happy Path:**

1. **Set isolated HOME:**
   ```bash
   export HOME=$(pwd)/.home
   npm install -g @vladimir-ks/claude-context-manager@0.4.0
   ```

2. **Check status before installation:**
   ```bash
   ccm status --global  # Should show no artifacts installed
   ```

3. **Install skill:**
   ```bash
   ccm install --skill managing-claude-context --global
   ```

4. **Check status after installation:**
   ```bash
   ccm status --global  # Should show managing-claude-context installed
   ```

5. **Verify status metadata:**
   ```bash
   ccm status --global | grep "Version:"  # Should show version number
   ccm status --global | grep "Checksum:"  # Should show checksum
   ```

**Expected Outcomes:**

- ✅ Status accurately reflects installation state
- ✅ Version numbers displayed correctly
- ✅ Checksums displayed
- ✅ Installation location shown
- ✅ Multi-location indicator (if applicable)

**Bug Reporting Triggers:**

- **High:** Status shows incorrect state, missing installed artifacts
- **Medium:** Metadata incorrect (version, checksum)
- **Low:** Formatting issues

---

### Scenario 2.3: backup-and-restore **[CHANGED IN v0.4.0]**

**Agent:** worktree-agent-3
**Purpose:** Validate backup creation and restoration workflows

**Changes in v0.4.0:**
- Enhanced backup-manager.js with dual detection (checksum + mtime)
- Improved backup creation logic

**Prerequisites:**
- Package installed in isolated HOME
- Artifact installed

**Happy Path:**

1. **Set isolated HOME and install:**
   ```bash
   export HOME=$(pwd)/.home
   npm install -g @vladimir-ks/claude-context-manager@0.4.0
   ccm install --skill managing-claude-context --global
   ```

2. **Modify artifact to trigger backup:**
   ```bash
   echo "# TEST MODIFICATION" >> $HOME/.claude/skills/managing-claude-context/SKILL.md
   ```

3. **Update artifact (should create backup):**
   ```bash
   ccm update --skill managing-claude-context
   ```

4. **Verify backup created:**
   ```bash
   ls $HOME/.claude/skills/managing-claude-context/*.backup-* | wc -l  # Should be > 0
   ```

5. **Test restore command:**
   ```bash
   ccm restore  # Interactive: select backup to restore
   ```

6. **Verify restoration:**
   ```bash
   # Check that file restored to previous state
   ```

7. **Test cleanup command:**
   ```bash
   ccm cleanup  # Should offer to clean old backups
   ```

**Expected Outcomes:**

- ✅ Backup created when user-modified file is updated
- ✅ Backup metadata includes reason, timestamp, version
- ✅ Restore command lists available backups
- ✅ Restoration works correctly
- ✅ Cleanup offers to remove old backups (90-day retention)
- ✅ Dual detection (checksum + mtime) works correctly

**Bug Reporting Triggers:**

- **Critical:** Backup not created, data lost during update
- **High:** Restore fails, backup metadata incorrect
- **Medium:** Cleanup doesn't work, retention policy incorrect
- **Low:** UI issues in interactive menus

---

### Scenario 2.4: artifact-installation-flows **[CHANGED IN v0.4.0]**

**Agent:** worktree-agent-4
**Purpose:** Validate artifact installation with different parameters

**Changes in v0.4.0:**
- 5 new QA commands added (ccm-artifact-package-manager, ccm-change-logger, ccm-prepare-test-scenarios, ccm-run-test-stage, ccm-test-deployment)
- doc-refactoring skill extensively updated (all components)
- managing-claude-context skill updated (SKILL.md, subagent guide)
- Deleted ccm-test.md command (replaced by QA suite)

**Prerequisites:**
- Package installed in isolated HOME

**Happy Path:**

1. **Setup:**
   ```bash
   export HOME=$(pwd)/.home
   npm install -g @vladimir-ks/claude-context-manager@0.4.0
   ```

2. **Install skill globally:**
   ```bash
   ccm install --skill managing-claude-context --global
   ls $HOME/.claude/skills/managing-claude-context/  # Should exist
   ```

3. **Install command globally:**
   ```bash
   ccm install --command ccm-bootstrap --global
   ls $HOME/.claude/commands/ccm-bootstrap.md  # Should exist
   ```

4. **Install package (bundle):**
   ```bash
   ccm install --package core-essentials --global
   ccm status --global  # Should show all artifacts from package
   ```

5. **Verify checksums:**
   ```bash
   cat $HOME/.claude-context-manager/registry.json | jq '.artifacts[] | {name, checksum}'
   # Should show correct checksums
   ```

6. **Verify permissions:**
   ```bash
   stat -f "%A" $HOME/.claude/skills/managing-claude-context/SKILL.md  # Should be 644
   stat -f "%A" $HOME/.claude/skills/managing-claude-context/  # Should be 755
   ```

**Expected Outcomes:**

- ✅ Skills installed to ~/.claude/skills/
- ✅ Commands installed to ~/.claude/commands/
- ✅ Packages install all bundled artifacts
- ✅ Checksums calculated and stored correctly
- ✅ File permissions set correctly (644 for files, 755 for dirs)
- ✅ Registry tracks all installations

**Bug Reporting Triggers:**

- **High:** Artifact not copied, checksum mismatch
- **Medium:** Permissions incorrect, registry not updated
- **Low:** Minor file operation issues

---

### Scenario 2.5: ccm-file-sync-validation **[CHANGED IN v0.4.0]**

**Agent:** worktree-agent-5
**Purpose:** Validate CCM file synchronization during postinstall

**Changes in v0.4.0:**
- Updated sync-engine.js
- Updated postinstall.js

**Prerequisites:**
- Package with CCM files installed

**Happy Path:**

1. **Setup:**
   ```bash
   export HOME=$(pwd)/.home
   ```

2. **Fresh install (triggers postinstall):**
   ```bash
   npm install -g @vladimir-ks/claude-context-manager@0.4.0
   ```

3. **Verify CCM files synced:**
   ```bash
   ls $HOME/.claude/ccm*.md | wc -l  # Should match number of CCM files in package
   ```

4. **Verify CLAUDE.md header:**
   ```bash
   head -50 $HOME/.claude/CLAUDE.md | grep "<!-- CCM CLAUDE.md PREFIX - START -->"  # Should exist
   head -50 $HOME/.claude/CLAUDE.md | grep "@./ccm01-USER-SETTINGS.md"  # Should exist
   ```

5. **Add user content to CLAUDE.md:**
   ```bash
   echo -e "\n## My Custom Section\nUser content here" >> $HOME/.claude/CLAUDE.md
   ```

6. **Re-run postinstall (simulates update):**
   ```bash
   cd $(npm root -g)/@vladimir-ks/claude-context-manager
   node scripts/postinstall.js
   ```

7. **Verify user content preserved:**
   ```bash
   grep "My Custom Section" $HOME/.claude/CLAUDE.md  # Should still exist
   ```

8. **Verify header regenerated:**
   ```bash
   head -50 $HOME/.claude/CLAUDE.md | grep "<!-- CCM CLAUDE.md PREFIX - START -->"  # Should exist
   ```

**Expected Outcomes:**

- ✅ All CCM files synced on install
- ✅ CLAUDE.md header generated with all file references
- ✅ User content below header preserved during update
- ✅ HTML comment markers used for header wrapping
- ✅ Backups created before modifying CLAUDE.md
- ✅ Checksums tracked in registry

**Bug Reporting Triggers:**

- **Critical:** User content lost from CLAUDE.md
- **High:** CCM files not synced, header not generated
- **Medium:** Checksum tracking incorrect, backup not created
- **Low:** Formatting issues in header

---

### Scenario 2.6: update-workflows **[CHANGED IN v0.4.0]**

**Agent:** worktree-agent-6
**Purpose:** Validate artifact update detection and execution

**Changes in v0.4.0:**
- New update-check.js command added
- Test new update-check CLI command

**Prerequisites:**
- Package installed with artifacts

**Happy Path:**

1. **Setup:**
   ```bash
   export HOME=$(pwd)/.home
   npm install -g @vladimir-ks/claude-context-manager@0.4.0
   ccm install --skill managing-claude-context --global
   ```

2. **Check for updates:**
   ```bash
   ccm update --check  # Should check for available updates
   ```

3. **Update specific artifact:**
   ```bash
   ccm update --skill managing-claude-context
   ```

4. **Verify update:**
   ```bash
   ccm status --global | grep "managing-claude-context"  # Should show updated version
   ```

5. **Update all artifacts:**
   ```bash
   ccm update --all
   ```

6. **Verify registry updated:**
   ```bash
   cat $HOME/.claude-context-manager/registry.json | jq '.artifacts[].version'
   # Should show current versions
   ```

**Expected Outcomes:**

- ✅ Update check detects available updates
- ✅ Artifact-specific update works
- ✅ Bulk update (--all) works
- ✅ Backups created before update
- ✅ Registry updated with new versions
- ✅ Checksums updated

**Bug Reporting Triggers:**

- **High:** Update fails, checksum mismatch after update
- **Medium:** Backup not created, registry not updated
- **Low:** Update check incorrect

---

### Scenario 2.7: feedback-and-notifications **[CHANGED IN v0.4.0]**

**Agent:** worktree-agent-7
**Purpose:** Validate GitHub integration and notification system

**Changes in v0.4.0:**
- New update-check.js command added
- Integration with notification system

**Prerequisites:**
- Package installed

**Happy Path:**

1. **Setup:**
   ```bash
   export HOME=$(pwd)/.home
   npm install -g @vladimir-ks/claude-context-manager@0.4.0
   ```

2. **Test notifications on:**
   ```bash
   ccm notifications on
   cat $HOME/.claude-context-manager/config.json | jq '.notifications.enabled'  # Should be true
   ```

3. **Test notifications check:**
   ```bash
   ccm notifications check  # Should check for updates
   ```

4. **Test notifications off:**
   ```bash
   ccm notifications off
   cat $HOME/.claude-context-manager/config.json | jq '.notifications.enabled'  # Should be false
   ```

5. **Test notifications status:**
   ```bash
   ccm notifications status  # Should show current state
   ```

**Expected Outcomes:**

- ✅ Notifications can be enabled/disabled
- ✅ Config file updated correctly
- ✅ Status command shows correct state
- ✅ Check command detects updates
- ✅ Rate limiting works (1 check per hour)

**Bug Reporting Triggers:**

- **Medium:** Notifications don't work, config not updated
- **Low:** Rate limiting incorrect, status display issues

---

### Scenario 2.8: project-initialization

**Agent:** worktree-agent-8
**Purpose:** Validate project initialization workflow

**Prerequisites:**
- Package installed
- Empty project directory

**Happy Path:**

1. **Setup:**
   ```bash
   export HOME=$(pwd)/.home
   npm install -g @vladimir-ks/claude-context-manager@0.4.0
   ```

2. **Create test project:**
   ```bash
   mkdir $HOME/test-project
   cd $HOME/test-project
   ```

3. **Initialize project:**
   ```bash
   ccm init
   ```

4. **Verify .claude/ directory created:**
   ```bash
   ls -la .claude/  # Should exist with subdirectories
   ls .claude/skills/ .claude/commands/ .claude/agents/  # Directories should exist
   ```

5. **Verify CLAUDE.md created:**
   ```bash
   cat .claude/CLAUDE.md | head -20  # Should contain project template
   ```

6. **Verify registry entry:**
   ```bash
   cat $HOME/.claude-context-manager/registry.json | jq '.projects'
   # Should include test-project
   ```

**Expected Outcomes:**

- ✅ .claude/ directory structure created
- ✅ CLAUDE.md template generated
- ✅ Project registered in registry
- ✅ Subdirectories created (skills/, commands/, agents/)

**Bug Reporting Triggers:**

- **High:** Init fails, directories not created
- **Medium:** CLAUDE.md template incorrect, registry not updated
- **Low:** Minor directory structure issues

---

### Scenario 2.9: error-handling-validation **[CHANGED IN v0.4.0]**

**Agent:** worktree-agent-9
**Purpose:** Validate error handling for common failure scenarios

**Changes in v0.4.0:**
- Entry point changes (bin/claude-context-manager.js)
- Verify error handling still works correctly

**Prerequisites:**
- Package installed

**Happy Path:**

1. **Setup:**
   ```bash
   export HOME=$(pwd)/.home
   npm install -g @vladimir-ks/claude-context-manager@0.4.0
   ```

2. **Test install non-existent artifact:**
   ```bash
   ccm install --skill non-existent-skill --global 2>&1
   # Should return error: "Artifact not found in catalog"
   ```

3. **Test uninstall non-installed artifact:**
   ```bash
   ccm uninstall --skill managing-claude-context --global 2>&1
   # Should return error: "Artifact not installed"
   ```

4. **Test registry corruption recovery:**
   ```bash
   echo "invalid json" > $HOME/.claude-context-manager/registry.json
   ccm status --global 2>&1  # Should handle gracefully and offer to recreate
   ```

5. **Test permissions error (simulate):**
   ```bash
   chmod 000 $HOME/.claude/
   ccm install --skill managing-claude-context --global 2>&1
   # Should return error: "Permission denied"
   chmod 755 $HOME/.claude/  # Restore permissions
   ```

**Expected Outcomes:**

- ✅ Error messages are clear and helpful
- ✅ No stack traces shown to user (unless debug mode)
- ✅ Graceful handling of corrupted files
- ✅ Permission errors detected and reported
- ✅ Exit codes non-zero on failure

**Bug Reporting Triggers:**

- **High:** Unhandled exceptions, stack traces shown
- **Medium:** Unclear error messages, wrong exit codes
- **Low:** Minor error message formatting

---

### Scenario 2.10: multi-location-tracking **[CHANGED IN v0.4.0]**

**Agent:** worktree-agent-10
**Purpose:** Validate multi-location artifact tracking

**Changes in v0.4.0:**
- Modified uninstall.js logic
- Verify multi-location warnings still work

**Prerequisites:**
- Package installed
- Multiple projects initialized

**Happy Path:**

1. **Setup:**
   ```bash
   export HOME=$(pwd)/.home
   npm install -g @vladimir-ks/claude-context-manager@0.4.0
   ```

2. **Install skill globally:**
   ```bash
   ccm install --skill managing-claude-context --global
   ```

3. **Create and init 3 projects:**
   ```bash
   mkdir $HOME/project1 $HOME/project2 $HOME/project3
   cd $HOME/project1 && ccm init && ccm install --skill managing-claude-context --project
   cd $HOME/project2 && ccm init && ccm install --skill managing-claude-context --project
   cd $HOME/project3 && ccm init && ccm install --skill managing-claude-context --project
   ```

4. **Check status (should show multi-location):**
   ```bash
   ccm status --all
   # Should show managing-claude-context in 4 locations (1 global + 3 projects)
   ```

5. **Test uninstall warning:**
   ```bash
   ccm uninstall --skill managing-claude-context --global
   # Should warn: "Artifact exists in 3 other locations"
   ```

6. **Verify multi-location tracking:**
   ```bash
   cat $HOME/.claude-context-manager/registry.json | jq '.multi_location_artifacts'
   # Should include managing-claude-context with 4 locations
   ```

**Expected Outcomes:**

- ✅ Registry tracks artifacts across multiple locations
- ✅ Status command shows all locations
- ✅ Uninstall warns about multi-location artifacts
- ✅ Update notifications show all locations
- ✅ No orphans after uninstall

**Bug Reporting Triggers:**

- **High:** Multi-location tracking incorrect, orphans created
- **Medium:** Status doesn't show all locations, warnings missing
- **Low:** Minor tracking issues

---

## Bug Report Format

When a test scenario fails, create a bug report in `.qa-reports/{version}/{timestamp}/bugs/bug-{N}.json`:

```json
{
  "bug_id": "bug-001",
  "stage": "2",
  "scenario": "2.5-ccm-file-sync",
  "agent_id": "worktree-agent-5",
  "severity": "critical|high|medium|low",
  "title": "Short description of bug",
  "description": "Detailed description of what went wrong",
  "reproduction_steps": [
    "Step 1",
    "Step 2",
    "Step 3"
  ],
  "expected_behavior": "What should have happened",
  "actual_behavior": "What actually happened",
  "affected_files": [
    "src/lib/sync-engine.js:line-range"
  ],
  "environment": {
    "platform": "darwin",
    "node_version": "20.10.0",
    "npm_version": "10.2.4",
    "home_directory": "/path/to/.home"
  },
  "suggested_fix": "Optional: How to fix this issue",
  "test_status": "fail"
}
```

**Severity Levels:**

- **Critical:** Data loss, security vulnerability, package non-functional
- **High:** Core feature broken, workflow blocked, incorrect behavior
- **Medium:** Feature degraded, workaround available, edge case bug
- **Low:** UI/UX issue, minor inconsistency, documentation error

---

## Test Execution Notes

**Stage 1 Execution:**
- Run sequentially (no parallel agents)
- Use real system (~/.claude-context-manager/)
- Create backup before testing
- Rollback if critical failure

**Stage 2 Execution:**
- Run in parallel (up to 10 agents simultaneously)
- Each agent in isolated worktree
- Each agent has isolated HOME directory
- No collision risk between agents

**Cleanup After Testing:**
- Remove all worktrees
- Rollback real system to pre-test state
- Consolidate bug reports
- Generate executive summary

---

**End of Manual Testing Procedures**
